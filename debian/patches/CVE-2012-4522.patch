Description: path name must not contain NUL bytes.
 This is a fix for CVE-2012-4522.
Author: Nobuyoshi Nakada  <nobu@ruby-lang.org>
Bug-Debian: http://bugs.debian.org/690670
Origin: upstream, https://github.com/ruby/ruby/commit/7085db45e4f15a58f9a82c8815bcc31364e0fde1
Reviewed-By: Antonio Terceiro <terceiro@debian.org>

--- ruby1.9.1-1.9.3.194.orig/file.c
+++ ruby1.9.1-1.9.3.194/file.c
@@ -174,6 +174,9 @@ rb_get_path_check(VALUE obj, int level)
 	rb_raise(rb_eEncCompatError, "path name must be ASCII-compatible (%s): %s",
 		 rb_enc_name(enc), RSTRING_PTR(tmp));
     }
+
+    StringValueCStr(tmp);
+
     return rb_str_new4(tmp);
 }
 
--- ruby1.9.1-1.9.3.194.orig/test/ruby/test_file.rb
+++ ruby1.9.1-1.9.3.194/test/ruby/test_file.rb
@@ -189,4 +189,14 @@ class TestFile < Test::Unit::TestCase
       assert_equal(File.chmod(0666, file), 1, bug5671)
     end
   end
+
+  def test_open_nul
+    Dir.mktmpdir(__method__.to_s) do |tmpdir|
+      path = File.join(tmpdir, "foo")
+      assert_raise(ArgumentError) do
+        open(path + "\0bar", "w") {}
+      end
+      assert_file_not(:exist?, path)
+    end
+  end
 end
